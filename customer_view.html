<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafe Menu</title>
    <!-- Google Fonts for Material You typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /*
        * Material You Inspired Color Palette
        * Tonal colors suitable for a cafe theme.
        */
        :root {
            --md-sys-color-primary: #6F4E37; /* A warm, deep brown */
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #F1E5D7; /* A light, creamy background */
            --md-sys-color-on-primary-container: #2A170C;
            --md-sys-color-secondary: #9C6644; /* A rich, toasted brown */
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #E8D3C3;
            --md-sys-color-on-secondary-container: #331A0D;
            --md-sys-color-tertiary: #A68A64; /* A soft, warm grey-brown */
            --md-sys-color-on-tertiary: #FFFFFF;
            --md-sys-color-tertiary-container: #EFE4D6;
            --md-sys-color-on-tertiary-container: #3A2E1C;
            --md-sys-color-background: #FFFBFF;
            --md-sys-color-on-background: #1C1B1F;
            --md-sys-color-surface: #FFFBFF;
            --md-sys-color-on-surface: #1C1B1F;
            --md-sys-color-surface-variant: #EDE0D3;
            --md-sys-color-on-surface-variant: #4A443B;
            --md-sys-color-outline: #7D7569;
            --animation-speed: 0.5s;
        }

        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
            transition: all var(--animation-speed) ease-in-out;
        }
        
        body {
            background-color: var(--md-sys-color-surface-variant);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
        }

        /* Container and layout */
        .container {
            max-width: 1200px;
            width: 100%;
            background-color: var(--md-sys-color-surface);
            border-radius: 28px; /* Large rounded corners for a soft feel */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            padding: 2.5rem;
            text-align: center;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-weight: 400;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            opacity: 0.8;
        }

        /* Main content and sections */
        .main-content {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
        }

        .menu-section {
            flex: 1 1 70%;
            padding: 2rem;
        }

        .cart-section {
            flex: 1 1 30%;
            background-color: var(--md-sys-color-tertiary-container);
            color: var(--md-sys-color-on-tertiary-container);
            padding: 2rem;
        }
        
        /* Section headings */
        .menu-section h2, .cart-section h2, .order-status-section h2 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 500;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--md-sys-color-secondary);
            padding-bottom: 0.5rem;
        }
        
        /* Menu categories */
        .menu-category {
            margin-bottom: 2rem;
        }

        .menu-category h3 {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            font-weight: 700;
            color: var(--md-sys-color-on-surface);
            margin-bottom: 1rem;
        }

        .menu-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        /* Individual menu items - Cards */
        .item-card {
            background-color: var(--md-sys-color-surface);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 16px;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform var(--animation-speed), box-shadow var(--animation-speed);
        }
        
        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .item-card:active {
            transform: scale(0.98);
        }

        .item-card h4 {
            font-weight: 500;
            font-size: 1.1rem;
            color: var(--md-sys-color-on-surface);
            margin-bottom: 0.25rem;
        }

        .item-card p.description {
            font-size: 0.875rem;
            color: var(--md-sys-color-on-surface-variant);
            margin-bottom: 0.75rem;
        }

        .price-and-btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-control button {
            background-color: var(--md-sys-color-secondary);
            color: var(--md-sys-color-on-secondary);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            transition: transform var(--animation-speed), background-color var(--animation-speed);
        }

        .quantity-control button:hover {
            background-color: var(--md-sys-color-primary);
        }

        .quantity-control button:active {
            transform: scale(0.95);
        }
        
        .quantity-control span {
            font-size: 1rem;
            font-weight: 500;
            color: var(--md-sys-color-on-surface);
        }

        .price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--md-sys-color-secondary);
        }

        .add-to-cart {
            background-color: var(--md-sys-color-secondary);
            color: var(--md-sys-color-on-secondary);
            border: none;
            padding: 0.625rem 1.25rem;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color var(--animation-speed), transform var(--animation-speed);
        }

        .add-to-cart:hover {
            background-color: var(--md-sys-color-primary);
            transform: scale(1.03);
        }
        
        .add-to-cart:active {
            transform: scale(0.98);
        }

        /* Cart section styling */
        .cart-items {
            list-style: none;
            margin-bottom: 1.5rem;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--md-sys-color-outline);
        }

        .item-info {
            display: flex;
            flex-direction: column;
        }

        .item-info span {
            font-weight: 500;
        }

        .item-info small {
            font-size: 0.8rem;
            color: var(--md-sys-color-on-secondary-container);
        }

        .item-actions button {
            background: none;
            border: none;
            color: var(--md-sys-color-primary);
            cursor: pointer;
            font-size: 0.9rem;
            margin: 0 0.25rem;
            transition: color var(--animation-speed), transform var(--animation-speed);
        }

        .item-actions button:hover {
            color: var(--md-sys-color-on-primary-container);
        }

        .item-actions button:active {
            transform: scale(0.95);
        }
        
        /* Totals */
        .cart-totals {
            margin-top: 2rem;
            border-top: 2px solid var(--md-sys-color-secondary);
            padding-top: 1rem;
        }

        .cart-totals div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        
        .cart-totals .total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--md-sys-color-primary);
        }

        .checkout-btn {
            width: 100%;
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            border: none;
            padding: 1rem;
            border-radius: 28px;
            cursor: pointer;
            font-weight: 500;
            font-size: 1.1rem;
            margin-top: 1.5rem;
            transition: background-color var(--animation-speed), transform var(--animation-speed);
        }

        .checkout-btn:hover {
            background-color: var(--md-sys-color-secondary);
            transform: translateY(-2px);
        }

        .checkout-btn:active {
            transform: scale(0.98);
        }
        
        /* Modal Popup Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            transition: all var(--animation-speed);
        }

        .modal-content {
            background-color: var(--md-sys-color-background);
            margin: 15% auto;
            padding: 2rem;
            border-radius: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 500px;
            position: relative;
            transform: scale(0.95);
            opacity: 0;
            transition: transform var(--animation-speed), opacity var(--animation-speed);
        }

        .modal.is-visible .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            color: var(--md-sys-color-on-surface-variant);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color var(--animation-speed), transform var(--animation-speed);
        }

        .close-btn:hover {
            color: var(--md-sys-color-primary);
        }

        .close-btn:active {
            transform: scale(0.95);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--md-sys-color-primary);
        }

        .summary-items {
            list-style: none;
            padding: 0;
            margin-bottom: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed var(--md-sys-color-outline);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-item .item-name {
            font-weight: 500;
        }

        .summary-item .item-price {
            font-weight: 400;
            color: var(--md-sys-color-on-surface-variant);
        }

        .summary-totals {
            margin-top: 1.5rem;
            border-top: 2px solid var(--md-sys-color-secondary);
            padding-top: 1rem;
        }

        .summary-totals .total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--md-sys-color-primary);
        }

        .modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .modal-buttons button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 28px;
            cursor: pointer;
            font-weight: 500;
            font-size: 1rem;
            transition: background-color var(--animation-speed), transform var(--animation-speed);
        }

        .modal-buttons button:active {
            transform: scale(0.98);
        }

        .confirm-btn {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }

        .confirm-btn:hover {
            background-color: var(--md-sys-color-secondary);
        }

        .cancel-btn {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
        }
        
        .cancel-btn:hover {
            background-color: var(--md-sys-color-outline);
        }

        .payment-modal-text {
            text-align: center;
            font-size: 1.2rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
            color: var(--md-sys-color-on-surface);
        }
        
        .payment-modal-text i {
            font-size: 3rem;
            color: green;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                padding-bottom: 8rem; /* Space for fixed checkout bar */
            }
            .menu-section, .cart-section {
                flex-basis: 100%;
                padding: 1.5rem;
            }
            .cart-section {
                display: none; /* Hide full cart section on mobile */
            }

            .mobile-cart-summary {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                background-color: var(--md-sys-color-tertiary-container);
                color: var(--md-sys-color-on-tertiary-container);
                padding: 1rem 1.5rem;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
                animation: slide-up var(--animation-speed);
            }

            @keyframes slide-up {
                from {
                    transform: translateY(100%);
                }
                to {
                    transform: translateY(0);
                }
            }

            .mobile-cart-summary .total {
                font-size: 1.25rem;
                font-weight: 700;
            }
            
            .mobile-cart-summary .checkout-btn {
                width: auto;
                padding: 0.75rem 1.5rem;
                margin-top: 0;
            }
        }
        
        /* Order Status Section Styles */
        .order-status-section {
            padding: 2rem;
            border-top: 1px solid var(--md-sys-color-outline);
            margin-top: 2rem;
            text-align: center;
        }
        
        .order-status-card {
            background-color: var(--md-sys-color-tertiary-container);
            color: var(--md-sys-color-on-tertiary-container);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 1rem auto;
            text-align: left;
        }

        .order-status-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .order-status-card p {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .status-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            color: var(--md-sys-color-on-primary);
        }
        
        /* Status colors */
        .status-Pending {
            background-color: orange;
        }
        .status-InProgress {
            background-color: var(--md-sys-color-secondary);
        }
        .status-Done {
            background-color: green;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Let's Eat</h1>
            <p>A Taste of Excellence in Every Sip & Bite</p>
        </header>
        <div class="main-content">
            <!-- Menu Section -->
            <section class="menu-section">
                <h2>Our Menu</h2>
                
                <div class="menu-category">
                    <h3>Coffee</h3>
                    <div class="menu-items">
                        <div class="item-card" data-name="Espresso" data-price="2.50">
                            <h4>Espresso</h4>
                            <p class="description">Strong, concentrated coffee shot. The perfect pick-me-up.</p>
                            <div class="price-and-btn">
                                <span class="price">$2.50</span>
                                <div class="quantity-control">
                                    <button class="decrease-qty" data-name="Espresso">-</button>
                                    <span class="item-qty" data-name="Espresso">1</span>
                                    <button class="increase-qty" data-name="Espresso">+</button>
                                </div>
                                <button class="add-to-cart">Add</button>
                            </div>
                        </div>
                        <div class="item-card" data-name="Latte" data-price="4.00">
                            <h4>Latte</h4>
                            <p class="description">Smooth espresso with steamed milk and a thin layer of foam.</p>
                            <div class="price-and-btn">
                                <span class="price">$4.00</span>
                                <div class="quantity-control">
                                    <button class="decrease-qty" data-name="Latte">-</button>
                                    <span class="item-qty" data-name="Latte">1</span>
                                    <button class="increase-qty" data-name="Latte">+</button>
                                </div>
                                <button class="add-to-cart">Add</button>
                            </div>
                        </div>
                        <div class="item-card" data-name="Cappuccino" data-price="4.50">
                            <h4>Cappuccino</h4>
                            <p class="description">A classic combination of espresso, steamed milk, and rich foam.</p>
                            <div class="price-and-btn">
                                <span class="price">$4.50</span>
                                <div class="quantity-control">
                                    <button class="decrease-qty" data-name="Cappuccino">-</button>
                                    <span class="item-qty" data-name="Cappuccino">1</span>
                                    <button class="increase-qty" data-name="Cappuccino">+</button>
                                </div>
                                <button class="add-to-cart">Add</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="menu-category">
                    <h3>Pastries</h3>
                    <div class="menu-items">
                        <div class="item-card" data-name="Croissant" data-price="3.00">
                            <h4>Croissant</h4>
                            <p class="description">Flaky, buttery pastry, baked fresh every morning.</p>
                            <div class="price-and-btn">
                                <span class="price">$3.00</span>
                                <div class="quantity-control">
                                    <button class="decrease-qty" data-name="Croissant">-</button>
                                    <span class="item-qty" data-name="Croissant">1</span>
                                    <button class="increase-qty" data-name="Croissant">+</button>
                                </div>
                                <button class="add-to-cart">Add</button>
                            </div>
                        </div>
                        <div class="item-card" data-name="Muffin" data-price="3.50">
                            <h4>Muffin</h4>
                            <p class="description">Your choice of blueberry, chocolate chip, or bran.</p>
                            <div class="price-and-btn">
                                <span class="price">$3.50</span>
                                <div class="quantity-control">
                                    <button class="decrease-qty" data-name="Muffin">-</button>
                                    <span class="item-qty" data-name="Muffin">1</span>
                                    <button class="increase-qty" data-name="Muffin">+</button>
                                </div>
                                <button class="add-to-cart">Add</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="menu-category">
                    <h3>Sandwiches</h3>
                    <div class="menu-items">
                        <div class="item-card" data-name="Turkey & Swiss" data-price="7.50">
                            <h4>Turkey & Swiss</h4>
                            <p class="description">Roasted turkey, Swiss cheese, and fresh greens on whole-wheat bread.</p>
                            <div class="price-and-btn">
                                <span class="price">$7.50</span>
                                <div class="quantity-control">
                                    <button class="decrease-qty" data-name="Turkey & Swiss">-</button>
                                    <span class="item-qty" data-name="Turkey & Swiss">1</span>
                                    <button class="increase-qty" data-name="Turkey & Swiss">+</button>
                                </div>
                                <button class="add-to-cart">Add</button>
                            </div>
                        </div>
                        <div class="item-card" data-name="Veggie Delight" data-price="6.50">
                            <h4>Veggie Delight</h4>
                            <p class="description">Assorted grilled vegetables, hummus, and feta on toasted ciabatta.</p>
                            <div class="price-and-btn">
                                <span class="price">$6.50</span>
                                <div class="quantity-control">
                                    <button class="decrease-qty" data-name="Veggie Delight">-</button>
                                    <span class="item-qty" data-name="Veggie Delight">1</span>
                                    <button class="increase-qty" data-name="Veggie Delight">+</button>
                                </div>
                                <button class="add-to-cart">Add</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Shopping Cart Section (Desktop Only) -->
            <aside class="cart-section">
                <h2>Your Order</h2>
                <ul class="cart-items">
                    <!-- Cart items will be dynamically added here -->
                </ul>
                <div class="cart-totals">
                    <div>
                        <span>Subtotal:</span>
                        <span id="subtotal" class="subtotal-amount">$0.00</span>
                    </div>
                    <div>
                        <span>Tax (8%):</span>
                        <span id="tax" class="tax-amount">$0.00</span>
                    </div>
                    <div class="total">
                        <span>Total:</span>
                        <span id="total" class="total-amount">$0.00</span>
                    </div>
                </div>
                <button class="checkout-btn">Checkout</button>
            </aside>
        </div>
        
        <!-- Order Status Section -->
        <section class="order-status-section">
            <h2>Your Order Status</h2>
            <div id="order-status-display">
                <p>Place an order to see its live status.</p>
            </div>
        </section>
    </div>
    
    <!-- Mobile Cart Summary (Fixed at bottom on mobile) -->
    <div class="mobile-cart-summary">
        <div class="total">
            Total: <span id="mobile-total">$0.00</span>
        </div>
        <button class="checkout-btn">Checkout</button>
    </div>

    <!-- Order Summary Modal Popup -->
    <div id="order-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="modal-header">
                <h3>Order Summary</h3>
            </div>
            <ul id="summary-items" class="summary-items">
                <!-- Summary items will be added here dynamically -->
            </ul>
            <div class="summary-totals">
                <div>
                    <span>Subtotal:</span>
                    <span id="summary-subtotal" class="summary-subtotal-amount"></span>
                </div>
                <div>
                    <span>Tax:</span>
                    <span id="summary-tax" class="summary-tax-amount"></span>
                </div>
                <div class="total">
                    <span>Total:</span>
                    <span id="summary-total" class="summary-total-amount"></span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="cancel-btn">Cancel</button>
                <button class="confirm-btn">Confirm Order</button>
            </div>
        </div>
    </div>

    <!-- Payment Confirmation Modal -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="modal-header">
                <h3>Order Confirmed!</h3>
            </div>
            <div class="payment-modal-text">
                <i class="fas fa-check-circle"></i>
                <p>Please proceed to the counter to pay and pick up your order. Thank you!</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, where, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Set Firebase logging level to debug
        setLogLevel('debug');

        // Global variables provided by the Canvas environment.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db, auth, userId;
        let recentOrderId = null; // Store the document ID of the user's most recent order

        // Real-time order status listener for the Customer View.
        function setupCustomerStatusListener() {
            if (!db || !userId) return;

            const ordersCollection = collection(db, `artifacts/${appId}/public/data/orders`);
            // We use a query to listen for changes to the user's specific order.
            // If the user has a recent order ID, we listen to that specific document.
            // Otherwise, we listen for a new order by this user.
            const userOrdersQuery = query(ordersCollection, where("customerUserId", "==", userId));

            onSnapshot(userOrdersQuery, (snapshot) => {
                const ordersDisplay = document.getElementById('order-status-display');
                ordersDisplay.innerHTML = '';
                if (snapshot.empty) {
                    ordersDisplay.innerHTML = '<p>Place an order to see its live status.</p>';
                    return;
                }
                
                snapshot.forEach((doc) => {
                    const orderData = doc.data();
                    const status = orderData.status;
                    const orderId = doc.id;

                    // Only show the most recent order for simplicity
                    if (orderId === recentOrderId || snapshot.size === 1) {
                         const statusCard = document.createElement('div');
                        statusCard.classList.add('order-status-card');
                        statusCard.innerHTML = `
                            <h3>Order #<span id="order-id-display">${orderId}</span></h3>
                            <p>Current Status: <span class="status-badge status-${status.replace(/\s+/g, '')}">${status}</span></p>
                            <p>You can find this order at the counter.</p>
                        `;
                        ordersDisplay.appendChild(statusCard);
                    }
                });
            });
        }

        async function initFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Firebase Authenticated. User ID:", userId);
                        setupCustomerStatusListener(); // Start the status listener
                    } else {
                        console.log("Firebase Auth State Changed: No user. Signing in anonymously...");
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (error) {
                            console.error("Authentication failed:", error);
                        }
                    }
                });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
            }
        }
        
        initFirebase();

        document.addEventListener('DOMContentLoaded', () => {
            const menuItems = document.querySelectorAll('.add-to-cart');
            const cartItemsContainer = document.querySelector('.cart-items');
            const subtotalEl = document.getElementById('subtotal');
            const taxEl = document.getElementById('tax');
            const totalEl = document.getElementById('total');
            const mobileTotalEl = document.getElementById('mobile-total');
            const checkoutBtns = document.querySelectorAll('.checkout-btn');
            
            // Modal elements
            const orderModal = document.getElementById('order-modal');
            const paymentModal = document.getElementById('payment-modal');
            const orderModalCloseBtn = orderModal.querySelector('.close-btn');
            const paymentModalCloseBtn = paymentModal.querySelector('.close-btn');
            const summaryItemsContainer = document.getElementById('summary-items');
            const summarySubtotalEl = document.getElementById('summary-subtotal');
            const summaryTaxEl = document.getElementById('summary-tax');
            const summaryTotalEl = document.getElementById('summary-total');
            const modalCancelBtn = document.querySelector('.modal-buttons .cancel-btn');
            const confirmBtn = document.querySelector('.confirm-btn');

            let cart = [];

            // Add item to cart
            menuItems.forEach(button => {
                button.addEventListener('click', (e) => {
                    const itemCard = e.target.closest('.item-card');
                    const name = itemCard.dataset.name;
                    const price = parseFloat(itemCard.dataset.price);
                    const quantityEl = itemCard.querySelector(`.item-qty[data-name="${name}"]`);
                    const quantity = parseInt(quantityEl.textContent, 10);
                    
                    if (quantity > 0) {
                        const existingItem = cart.find(item => item.name === name);
                        
                        if (existingItem) {
                            existingItem.quantity += quantity;
                        } else {
                            cart.push({ name, price, quantity });
                        }
                    }
                    
                    updateCart();
                });
            });

            // Quantity controls on menu cards
            document.querySelectorAll('.increase-qty').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent card from being "tapped"
                    const name = e.target.dataset.name;
                    const quantityEl = document.querySelector(`.item-qty[data-name="${name}"]`);
                    let quantity = parseInt(quantityEl.textContent, 10);
                    quantity++;
                    quantityEl.textContent = quantity;
                });
            });

            document.querySelectorAll('.decrease-qty').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent card from being "tapped"
                    const name = e.target.dataset.name;
                    const quantityEl = document.querySelector(`.item-qty[data-name="${name}"]`);
                    let quantity = parseInt(quantityEl.textContent, 10);
                    if (quantity > 1) {
                        quantity--;
                        quantityEl.textContent = quantity;
                    }
                });
            });

            // Update cart display
            function updateCart() {
                cartItemsContainer.innerHTML = '';
                cart.forEach(item => {
                    const li = document.createElement('li');
                    li.classList.add('cart-item');
                    li.innerHTML = `
                        <div class="item-info">
                            <span>${item.name}</span>
                            <small>$${item.price.toFixed(2)} x ${item.quantity}</small>
                        </div>
                        <div class="item-actions">
                            <button class="increase-item" data-name="${item.name}"><i class="fas fa-plus"></i></button>
                            <button class="decrease-item" data-name="${item.name}"><i class="fas fa-minus"></i></button>
                            <button class="remove-item" data-name="${item.name}"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(li);
                });

                // Attach event listeners to new buttons
                attachCartEventListeners();
                updateTotals();
            }

            // Attach listeners for cart actions
            function attachCartEventListeners() {
                document.querySelectorAll('.increase-item').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const name = this.dataset.name;
                        const item = cart.find(item => item.name === name);
                        if (item) {
                            item.quantity++;
                            updateCart();
                        }
                    });
                });
                
                document.querySelectorAll('.decrease-item').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const name = this.dataset.name;
                        const item = cart.find(item => item.name === name);
                        if (item && item.quantity > 1) {
                            item.quantity--;
                            updateCart();
                        } else if (item && item.quantity === 1) {
                            cart = cart.filter(cartItem => cartItem.name !== name);
                            updateCart();
                        }
                    });
                });
                
                document.querySelectorAll('.remove-item').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const name = this.dataset.name;
                        cart = cart.filter(cartItem => cartItem.name !== name);
                        updateCart();
                    });
                });
            }
            
            // Calculate and update totals
            function updateTotals() {
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const tax = subtotal * 0.08; // 8% tax
                const total = subtotal + tax;
                
                subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
                taxEl.textContent = `$${tax.toFixed(2)}`;
                totalEl.textContent = `$${total.toFixed(2)}`;
                mobileTotalEl.textContent = `$${total.toFixed(2)}`;
            }
            
            // Show order summary modal on checkout button click
            checkoutBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (cart.length > 0) {
                        populateSummary();
                        orderModal.style.display = 'flex';
                        setTimeout(() => orderModal.classList.add('is-visible'), 10);
                    }
                });
            });

            // Close order summary modal
            orderModalCloseBtn.addEventListener('click', () => {
                orderModal.classList.remove('is-visible');
                setTimeout(() => orderModal.style.display = 'none', 500);
            });
            
            // Close order summary modal when cancel button is clicked
            modalCancelBtn.addEventListener('click', () => {
                orderModal.classList.remove('is-visible');
                setTimeout(() => orderModal.style.display = 'none', 500);
            });

            // Confirm order and show payment modal
            confirmBtn.addEventListener('click', async () => {
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const tax = subtotal * 0.08;
                const total = subtotal + tax;

                const order = {
                    items: cart,
                    subtotal: subtotal,
                    tax: tax,
                    total: total,
                    timestamp: new Date(),
                    status: 'Pending', // Initial status is Pending
                    customerUserId: userId
                };

                try {
                    const ordersCollection = collection(db, `artifacts/${appId}/public/data/orders`);
                    const docRef = await addDoc(ordersCollection, order);
                    recentOrderId = docRef.id;
                    console.log("Order submitted successfully with ID: ", recentOrderId);
                } catch (e) {
                    console.error("Error adding document: ", e);
                }

                orderModal.classList.remove('is-visible');
                setTimeout(() => orderModal.style.display = 'none', 500);
                
                paymentModal.style.display = 'flex';
                setTimeout(() => paymentModal.classList.add('is-visible'), 510);
                
                cart = []; // Clear the cart
                updateCart();
            });

            // Close payment modal
            paymentModalCloseBtn.addEventListener('click', () => {
                paymentModal.classList.remove('is-visible');
                setTimeout(() => paymentModal.style.display = 'none', 500);
            });

            // Close modals when clicking outside of them
            window.addEventListener('click', (event) => {
                if (event.target === orderModal) {
                    orderModal.classList.remove('is-visible');
                    setTimeout(() => orderModal.style.display = 'none', 500);
                }
                if (event.target === paymentModal) {
                    paymentModal.classList.remove('is-visible');
                    setTimeout(() => paymentModal.style.display = 'none', 500);
                }
            });
            
            // Populate the order summary modal
            function populateSummary() {
                summaryItemsContainer.innerHTML = '';
                let summarySubtotal = 0;
                
                cart.forEach(item => {
                    const li = document.createElement('li');
                    li.classList.add('summary-item');
                    li.innerHTML = `
                        <span class="item-name">${item.name} (${item.quantity})</span>
                        <span class="item-price">$${(item.price * item.quantity).toFixed(2)}</span>
                    `;
                    summaryItemsContainer.appendChild(li);
                    summarySubtotal += item.price * item.quantity;
                });
                
                const summaryTax = summarySubtotal * 0.08;
                const summaryTotal = summarySubtotal + summaryTax;
                
                summarySubtotalEl.textContent = `$${summarySubtotal.toFixed(2)}`;
                summaryTaxEl.textContent = `$${summaryTax.toFixed(2)}`;
                summaryTotalEl.textContent = `$${summaryTotal.toFixed(2)}`;
            }
        });
    </script>
    // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyA8AVPSwtxz5RSLNsv8SB5J8l2nUfaPCQc",
  authDomain: "buman-socials-d54f1.firebaseapp.com",
  projectId: "buman-socials-d54f1",
  storageBucket: "buman-socials-d54f1.firebasestorage.app",
  messagingSenderId: "743247813501",
  appId: "1:743247813501:web:4ed1b80136d495d8954a14",
  measurementId: "G-X1JD6PMJ5R"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
</body>
</html>
